# **《CryptoChat 软件帮助文档及faq》**

**一、程序概述**

本程序是一个基于 TCP 协议的加密聊天应用，支持服务器和客户端模式。服务器端可以接受多个客户端连接，实现多人实时聊天功能。它具备用户认证、房间管理、加密通信、封禁系统等特性，可用于小型团队协作或社交聊天场景。

**二、主要功能**

- **服务器功能**
  - 启动聊天服务器，监听指定端口，接受客户端连接。
  - 支持设置最大用户数量限制。
  - 提供管理员命令行界面，用于管理用户、房间和执行其他操作。
  - 可以设置和验证服务器密码，保护聊天环境。
  - 支持多房间聊天，管理员可以创建、配置和管理房间。
  - 具备封禁系统，可以封禁特定用户或 IP 地址，维护聊天秩序。

- **客户端功能**
  - 连接到指定的服务器，发送和接收消息。
  - 支持多种命令，如查看在线用户、测试延迟等。
  - 可以加入不同的聊天房间（如果服务器启用房间功能）。
  - 使用公钥加密通信，保障消息的安全性。

**三、使用方法**

### **服务器端使用方法**

1. 确保安装了 Python 3.10 或更高版本。
2. 将程序文件保存为 `chat.py`。
3. 在命令行中运行：
   ```bash
   python chat.py
   ```
4. 等待客户端连接，通过管理员命令行进行管理。

### **客户端使用方法**

1. 确保安装了 Python 3.10 或更高版本。
2. 将程序文件保存为 `chat.py`。
3. 在命令行中运行：
   ```bash
   python chat.py
   ```
4. 按照提示输入服务器地址和端口（默认为 `localhost:25566`）。
5. 输入昵称，连接到服务器后即可开始聊天。
6. 使用命令（如 `/help` 查看帮助）进行其他操作。

**四、可能的配置错误及解决方法**

### **1. 端口问题**

- **错误表现**：服务器无法启动或客户端无法连接，提示端口相关错误。
- **解决方法**：检查端口是否被其他程序占用。可以通过在命令行中运行以下命令查看端口使用情况：
  ```bash
  netstat -ano | findstr [port_number]
  ```
  如果端口被占用，修改 `chat.properties` 文件中的端口号，或者关闭占用该端口的程序。

### **2. 配置文件错误**

- **错误表现**：程序启动时提示配置文件格式错误或缺少关键配置项。
- **解决方法**：检查 `chat.properties` 文件的格式是否正确。确保每个配置项的格式为 `key=value`，并且没有多余的空格或特殊字符。根据文档中的配置项说明，补充缺失的配置项。

### **3. 加密相关错误**

- **错误表现**：加密通信出现问题，如密钥生成失败、加密解密错误等。
- **解决方法**：
  - 确认加密算法配置正确（如 RSA、DSA、ECDSA 等），并且密钥文件路径正确。
  - 检查密钥长度是否符合算法要求。
  - 如果问题仍然存在，可以尝试重新生成密钥对。运行程序时，它会自动检测密钥文件是否存在，如果不存在会自动生成。

### **4. 房间配置错误**

- **错误表现**：服务器端加载房间配置失败，或者客户端无法加入房间。
- **解决方法**：
  - 检查房间配置文件（位于 `./room_config/` 目录下的 `.cfg` 文件）格式是否正确。
  - 确保每个房间配置文件包含必要的信息，如房间名称、欢迎消息等。
  - 检查房间名称是否重复或包含特殊字符。

**五、常见问题（FAQ）**

### **1. 如何修改服务器的最大用户数量限制？**

**答**：在 `chat.properties` 文件中找到 `max_users` 配置项，将其值修改为你想要的最大用户数量。例如：
```properties
max_users=50
```
表示最多允许 50 个用户连接。

### **2. 如何启用或禁用房间功能？**

**答**：在 `chat.properties` 文件中找到 `enable_rooms` 配置项，将其值设置为 `true` 启用房间功能，设置为 `false` 禁用房间功能。例如：
```properties
enable_rooms=true
```

### **3. 如何设置服务器密码？**

**答**：在服务器端管理员命令行中使用以下命令设置服务器密码：
```bash
/setpassword [your_password]
```
如果启用了哈希功能，密码会被哈希存储。

### **4. 如何创建新的聊天房间？**

**答**：在服务器端管理员命令行中使用以下命令创建新的聊天房间：
```bash
/addroom [room_name]
```
然后可以在房间配置目录下（默认为 `./room_config/`）找到对应的配置文件进行进一步配置。

### **5. 如何封禁一个用户？**

**答**：在服务器端管理员命令行中使用以下命令封禁用户：
- 全局封禁用户：
  ```bash
  /ban global [nickname]
  ```
- 在指定房间封禁用户或 IP：
  ```bash
  /ban [room_name] [nickname|IP]
  ```

**六、配置项说明**

以下是在 `chat.properties` 文件中的主要配置项及其说明：

| 配置项               | 说明                                                                 |
|----------------------|----------------------------------------------------------------------|
| `mode`               | 设置程序运行模式，可选值为 `server`（服务器模式）或 `client`（客户端模式）。 |
| `ip`                 | 服务器监听的 IP 地址（服务器模式）或要连接的服务器 IP 地址（客户端模式）。 |
| `port`               | 服务器监听的端口号（服务器模式）或要连接的服务器端口号（客户端模式）。     |
| `encrypt_algorithm`  | 加密算法，可选值包括 `RSA`、`DSA`、`ECDSA` 等。                         |
| `key_length`         | 密钥长度，不同加密算法有不同的密钥长度要求。                           |
| `nickname`           | 客户端的昵称。                                                        |
| `motd`               | 服务器的欢迎消息（Message of the Day）。                              |
| `max_users`          | 服务器允许的最大用户数量（仅在服务器模式下有效）。                     |
| `pubkey_file`        | 公钥文件路径。                                                        |
| `key_file`           | 私钥文件路径。                                                        |
| `enable_rooms`       | 是否启用房间功能。                                                    |
| `room_config`        | 房间配置文件目录路径。                                                |
| `enable_hash`        | 是否启用密码哈希功能。                                                |
| `hash_type`          | 哈希算法类型，如 `sha256`、`md5` 等。                                |
| `enable_password`    | 是否启用服务器密码保护。                                              |
| `enable_autosave`    | 是否启用自动保存聊天记录功能。                                        |

**七、安全注意事项**

1. 保护好服务器私钥文件，避免泄露，否则攻击者可能能够解密聊天内容。
2. 如果启用密码保护，不要使用过于简单或容易猜测的密码，并定期更换密码。
3. 对于封禁系统，谨慎使用封禁功能，确保不会误封正常用户。
4. 定期检查和更新程序，以修复可能的安全漏洞。

**八、命令参考**

### **服务器端管理员命令**

| 命令                  | 说明                                                                 |
|-----------------------|----------------------------------------------------------------------|
| `/kick <nickname>`    | 踢出指定用户。                                                       |
| `/ban <room> <target>`| 在指定房间或全局封禁用户或 IP。                                      |
| `/unban <room> <target>` | 解除指定房间或全局的封禁。                                           |
| `/check <nickname>`   | 查看用户信息。                                                       |
| `/listbans [room]`    | 列出封禁列表。                                                       |
| `/stop`               | 停止服务器。                                                         |
| `/help`               | 显示帮助信息。                                                       |
| `/setpassword <password>` | 设置服务器密码。                                                    |
| `/hashpassword`       | 对服务器密码进行哈希处理。                                           |
| `/roompassword <room> <password>` | 设置房间密码。                                                     |
| `/save`               | 保存聊天记录。                                                       |

### **客户端命令**

| 命令                  | 说明                                                                 |
|-----------------------|----------------------------------------------------------------------|
| `/ping`               | 测试服务器延迟。                                                     |
| `/online`             | 查看在线用户列表。                                                   |
| `/join <room>`        | 加入指定房间。                                                       |
| `/rooms`              | 列出可用房间。                                                       |
| `/exit`               | 退出聊天。                                                           |
| `/help`               | 显示帮助信息。                                                       |
| `/save`               | 保存聊天记录。                                                       |

**九、示例配置文件**

以下是一个示例 `chat.properties` 文件内容：

```properties
mode=server
ip=localhost
port=25566
encrypt_algorithm=RSA
key_length=2048
nickname=Admin
motd=Welcome to CryptoChat!
max_users=20
pubkey_file=public_key.pem
key_file=private_key.pem
enable_rooms=false
room_config=./room_config/
enable_hash=false
hash_type=sha256
enable_password=false
enable_autosave=true
```

**十、技术支持**

如果在使用过程中遇到问题，可以通过以下方式获取支持：
- 提交问题到 [GitHub Issues](https://github.com/Dinnerb0ne2/CryptoChat/issues)
- 联系开发者邮箱：tomma_2022@outlook.com
- 联系[T0ast](https://github.com/T0ast101CN)，使其通过物理方法联系Tom Ma
